<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/5fda38894b.js" crossorigin="anonymous"></script>
    <link rel = "stylesheet" type="text/css" href="../../../../css/main.css" />
    <title>PUL GitHub Issues for 2022-12-28T22:00:04</title>
  </head>

<body>
  <div class="container-fluid">
    <a id="btt-button"></a>
    
<h1 class="bg-dark text-light">PUL GitHub Issues<br />
  <small class="text-white-70">2022-12-28</small></h1>
<nav class="navbar sticky-top navbar-dark bg-dark">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-toggler" aria-controls="navbar-toggler" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbar-toggler">
    <ul class="navbar-nav mr-auto mt-2 pt-3 mt-lg-0">
      <li class="nav-item not-mono">
        <a class="nav-link" href="../../../../index.html"><i class="fas fa-arrow-left"></i> Back to Report List Page</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#orangelight">pulibrary/orangelight</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#pdc_describe">pulibrary/pdc_describe</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#princeton_ansible">pulibrary/princeton_ansible</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#pul-it-handbook">pulibrary/pul-it-handbook</a>
      </li>
      </li>
    </ul>
  </div>
</nav>

    
    <section class="repo" id="orangelight">
      <h2><a href="https://github.com/pulibrary/orangelight">pulibrary/orangelight</a> <i class="fas fa-external-link-alt fa-xs"></i></h2>
      <div class="issues">
        
      <div class="issue even" id="orangelight-3324">
        <h3><a href="https://github.com/pulibrary/orangelight/pull/3324">#3324</a> [WIP] Increase cpu and ram in docker container - update capybara selenium configuration</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Christina Chortaria</dd>
          <dt>Created:</dt>
          <dd>2022-12-28 13:42:09</dd>
          <dt>Status:</dt>
          <dd>Open
          (<a href="https://github.com/pulibrary/orangelight/pull/3324">pull request</a>)
          </dd>
          <dt>Comments:</dt>
          

          <dd class="comments">
            <dl>
              <dt>Coveralls at <a href="https://github.com/pulibrary/orangelight/pull/3324#issuecomment-1366688019">2022-12-28 17:08:10</a> <i class="fas fa-external-link-alt fa-xs"></i> :</dt>
              <dd class="even">
                <p><a href="https://coveralls.io/builds/55500298"><img src="https://coveralls.io/builds/55500298/badge" alt="Coverage Status"></a></p>

<p>Coverage: 94.533%. Remained the same when pulling <strong>1eeb5852053d8ffdbba562049c616c909265c257 on cpu-circleci</strong> into <strong>8e0010d5041f7829892c41bee2d6a931e409b5b6 on main</strong>.</p>

              </dd>
            </dl>
          </dd>

          <dt>Events:</dt>
          <dd>
            <ul class="events">
            
  <li class="event even">
    <code>renamed</code> by Christina Chortaria at 2022-12-28 14:11:34.</li>
  <li class="event odd">
    <code>head_ref_force_pushed</code> by Christina Chortaria at 2022-12-28 16:46:39.</li>
  <li class="event even">
    <code>head_ref_force_pushed</code> by Christina Chortaria at 2022-12-28 16:58:02.</li>
  <li class="event odd">
    <code>renamed</code> by Christina Chortaria at 2022-12-28 17:49:40.</li>
  <li class="event even">
    <code>ready_for_review</code> by Christina Chortaria at 2022-12-28 17:50:47.</li>
  <li class="event odd">
    <code>convert_to_draft</code> by Christina Chortaria at 2022-12-28 17:56:01.</li>
  <li class="event even">
    <code>renamed</code> by Christina Chortaria at 2022-12-28 17:56:15.</li>

            </ul>
          </dd>
        </dl>
      </div>

      </div>
    </section>
    <section class="repo" id="pdc_describe">
      <h2><a href="https://github.com/pulibrary/pdc_describe">pulibrary/pdc_describe</a> <i class="fas fa-external-link-alt fa-xs"></i></h2>
      <div class="issues">
        
      <div class="issue even" id="pdc_describe-800">
        <h3><a href="https://github.com/pulibrary/pdc_describe/pull/800">#800</a> Reformat work page with tabular layout / bold labels</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Chuck McCallum</dd>
          <dt>Created:</dt>
          <dd>2022-12-23 21:32:50</dd>
          <dt>Status:</dt>
          <dd>Closed
          (<a href="https://github.com/pulibrary/pdc_describe/pull/800">pull request</a>)
          </dd>
          <dt>Events:</dt>
          <dd>
            <ul class="events">
            
  <li class="event even">
    <code>review_requested</code> by James R. Griffin III at 2022-12-28 14:28:55.</li>
  <li class="event odd">
    <code>deployed</code> by None at 2022-12-28 14:29:25.</li>
  <li class="event even">
    <code>referenced</code> by James R. Griffin III at 2022-12-28 14:41:10.</li>
  <li class="event odd">
    <code>merged</code> by James R. Griffin III at 2022-12-28 14:41:10.</li>
  <li class="event even">
    <code>closed</code> by James R. Griffin III at 2022-12-28 14:41:10.</li>
  <li class="event odd">
    <code>head_ref_deleted</code> by James R. Griffin III at 2022-12-28 14:41:11.</li>

            </ul>
          </dd>
        </dl>
      </div>
      <div class="issue odd" id="pdc_describe-746">
        <h3><a href="https://github.com/pulibrary/pdc_describe/issues/746">#746</a> Describe Record: Changes to Rendered Record Appearance (to discuss)</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Hannah H</dd>
          <dt>Created:</dt>
          <dd>2022-12-14 19:43:32</dd>
          <dt>Status:</dt>
          <dd>Closed
          </dd>
          <dt>Events:</dt>
          <dd>
            <ul class="events">
            
  <li class="event even">
    <code>closed</code> by James R. Griffin III at 2022-12-28 14:41:11.</li>

            </ul>
          </dd>
        </dl>
      </div>
      <div class="issue even" id="pdc_describe-801">
        <h3><a href="https://github.com/pulibrary/pdc_describe/pull/801">#801</a> Ensuring that Work#approve logs a message indicating that the Work was successfully published by the curator user</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>James R. Griffin III</dd>
          <dt>Created:</dt>
          <dd>2022-12-28 15:49:40</dd>
          <dt>Status:</dt>
          <dd>Open
          (<a href="https://github.com/pulibrary/pdc_describe/pull/801">pull request</a>)
          </dd>
        </dl>
      </div>

      </div>
    </section>
    <section class="repo" id="princeton_ansible">
      <h2><a href="https://github.com/pulibrary/princeton_ansible">pulibrary/princeton_ansible</a> <i class="fas fa-external-link-alt fa-xs"></i></h2>
      <div class="issues">
        
      <div class="issue even" id="princeton_ansible-3577">
        <h3><a href="https://github.com/pulibrary/princeton_ansible/issues/3577">#3577</a> [ealapps] URLs that don't end in a slash give "Something went wrong" error</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Jane Sandberg</dd>
          <dt>Created:</dt>
          <dd>2022-12-23 15:46:22</dd>
          <dt>Status:</dt>
          <dd>Open
          </dd>
          <dt>Comments:</dt>
          

          <dd class="comments">
            <dl>
              <dt>tventimi at <a href="https://github.com/pulibrary/princeton_ansible/issues/3577#issuecomment-1366653565">2022-12-28 13:27:13</a> <i class="fas fa-external-link-alt fa-xs"></i> :</dt>
              <dd class="even">
                <p>The error &quot;Looks like something went wrong!&quot; no longer occurs, but without the final slash, URLs are still converted to eal-apps-prod and appear that way in the address bar of the browser.</p>

              </dd>
            </dl>
          </dd>

        </dl>
      </div>
      <div class="issue odd" id="princeton_ansible-2648">
        <h3><a href="https://github.com/pulibrary/princeton_ansible/pull/2648">#2648</a> adds variables to manage nginx server hash table</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Alicia Cozine</dd>
          <dt>Created:</dt>
          <dd>2022-01-06 17:49:14</dd>
          <dt>Status:</dt>
          <dd>Closed
          (<a href="https://github.com/pulibrary/princeton_ansible/pull/2648">pull request</a>)
          </dd>
          <dt>Comments:</dt>
          

          <dd class="comments">
            <dl>
              <dt>Alicia Cozine at <a href="https://github.com/pulibrary/princeton_ansible/pull/2648#issuecomment-1366820611">2022-12-28 17:47:58</a> <i class="fas fa-external-link-alt fa-xs"></i> :</dt>
              <dd class="even">
                <p>This <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#server_names_hash_max_size">documentation</a> says the <code>server_names_hash_max_size</code> defaults to <code>512</code>, so if we want to increase it we should choose a larger number than that.</p>

              </dd>
              <dt>Alicia Cozine at <a href="https://github.com/pulibrary/princeton_ansible/pull/2648#issuecomment-1366830691">2022-12-28 18:06:36</a> <i class="fas fa-external-link-alt fa-xs"></i> :</dt>
              <dd class="odd">
                <p>Closing in favor of #3578.</p>

<p>This PR was closed when I deleted my fork of the repo and started pushing my branches directly to the main repo. The branch this PR was built on was on my fork, which no longer exists. </p>

              </dd>
            </dl>
          </dd>

          <dt>Events:</dt>
          <dd>
            <ul class="events">
            
  <li class="event even">
    <code>closed</code> by Alicia Cozine at 2022-12-28 18:06:37.</li>

            </ul>
          </dd>
        </dl>
      </div>
      <div class="issue even" id="princeton_ansible-3578">
        <h3><a href="https://github.com/pulibrary/princeton_ansible/pull/3578">#3578</a> Expand nginx server hash table</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Alicia Cozine</dd>
          <dt>Created:</dt>
          <dd>2022-12-28 18:05:19</dd>
          <dt>Status:</dt>
          <dd>Open
          (<a href="https://github.com/pulibrary/princeton_ansible/pull/3578">pull request</a>)
          </dd>
          <dt>Comments:</dt>
          

          <dd class="comments">
            <dl>
              <dt>Alicia Cozine at <a href="https://github.com/pulibrary/princeton_ansible/pull/3578#issuecomment-1366831943">2022-12-28 18:09:00</a> <i class="fas fa-external-link-alt fa-xs"></i> :</dt>
              <dd class="even">
                <p>Relevant links include:
<a href="https://nginx.org/en/docs/hash.html">https://nginx.org/en/docs/hash.html</a>
<a href="https://stackoverflow.com/questions/13895933/nginx-emerg-could-not-build-the-server-names-hash-you-should-increase-server">https://stackoverflow.com/questions/13895933/nginx-emerg-could-not-build-the-server-names-hash-you-should-increase-server</a>
<a href="https://serverfault.com/questions/419847/nginx-setting-server-names-hash-max-size-and-server-names-hash-bucket-size">https://serverfault.com/questions/419847/nginx-setting-server-names-hash-max-size-and-server-names-hash-bucket-size</a></p>

              </dd>
            </dl>
          </dd>

        </dl>
      </div>
      <div class="issue odd" id="princeton_ansible-3579">
        <h3><a href="https://github.com/pulibrary/princeton_ansible/pull/3579">#3579</a> Removes postgresql google cloud artifacts</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Alicia Cozine</dd>
          <dt>Created:</dt>
          <dd>2022-12-28 18:46:14</dd>
          <dt>Status:</dt>
          <dd>Open
          (<a href="https://github.com/pulibrary/princeton_ansible/pull/3579">pull request</a>)
          </dd>
        </dl>
      </div>
      <div class="issue even" id="princeton_ansible-3580">
        <h3><a href="https://github.com/pulibrary/princeton_ansible/pull/3580">#3580</a> Configure sitemap cacheing in nginx for orangelight</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Alicia Cozine</dd>
          <dt>Created:</dt>
          <dd>2022-12-28 20:37:33</dd>
          <dt>Status:</dt>
          <dd>Open
          (<a href="https://github.com/pulibrary/princeton_ansible/pull/3580">pull request</a>)
          </dd>
        </dl>
      </div>
      <div class="issue odd" id="princeton_ansible-3436">
        <h3><a href="https://github.com/pulibrary/princeton_ansible/issues/3436">#3436</a> Cache orangelight requests under /sitemap</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Jane Sandberg</dd>
          <dt>Created:</dt>
          <dd>2022-11-16 19:14:44</dd>
          <dt>Status:</dt>
          <dd>Open
          </dd>
          <dt>Comments:</dt>
          

          <dd class="comments">
            <dl>
              <dt>Alicia Cozine at <a href="https://github.com/pulibrary/princeton_ansible/issues/3436#issuecomment-1366903896">2022-12-28 20:37:47</a> <i class="fas fa-external-link-alt fa-xs"></i> :</dt>
              <dd class="even">
                <p>Looked at <a href="https://docs.nginx.com/nginx/admin-guide/content-cache/content-caching/">https://docs.nginx.com/nginx/admin-guide/content-cache/content-caching/</a> and <a href="https://www.nginx.com/blog/nginx-caching-guide/">https://www.nginx.com/blog/nginx-caching-guide/</a> for guidance.</p>

              </dd>
            </dl>
          </dd>

        </dl>
      </div>
      <div class="issue even" id="princeton_ansible-3319">
        <h3><a href="https://github.com/pulibrary/princeton_ansible/issues/3319">#3319</a> Run nginx -t on the inactive adc before applying a potentially destructive change</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Jane Sandberg</dd>
          <dt>Created:</dt>
          <dd>2022-09-06 19:25:41</dd>
          <dt>Status:</dt>
          <dd>Open
          </dd>
          <dt>Comments:</dt>
          

          <dd class="comments">
            <dl>
              <dt>Alicia Cozine at <a href="https://github.com/pulibrary/princeton_ansible/issues/3319#issuecomment-1366913462">2022-12-28 21:01:32</a> <i class="fas fa-external-link-alt fa-xs"></i> :</dt>
              <dd class="even">
                <p>See also the documentation in the pul-it-handbook:
<a href="https://github.com/pulibrary/pul-it-handbook/blob/main/services/nginxplus.md">https://github.com/pulibrary/pul-it-handbook/blob/main/services/nginxplus.md</a></p>

              </dd>
              <dt>Alicia Cozine at <a href="https://github.com/pulibrary/princeton_ansible/issues/3319#issuecomment-1366927787">2022-12-28 21:36:55</a> <i class="fas fa-external-link-alt fa-xs"></i> :</dt>
              <dd class="odd">
                <p>Ansible gathers the IP address(es) of all hosts during fact gathering. We can use this to control the logic of the nginxplus playbook. For example, this playbook:
```
- name: test safer nginxplus approach
  hosts: nginxplus<em>production
  remote</em>user: pulsys
  strategy: linear
  become: true
  vars<em>files:
    - ../group</em>vars/nginxplus/main.yml
  tasks:
    - name: check on IP addresses
      debug: var=ansible<em>all</em>ipv4_addresses</p>

<pre><code>- name: ping only the inactive VM
  ping:
  when: &quot;&#39;128.112.203.146&#39; not in ansible_all_ipv4_addresses&quot;
</code></pre>

<pre><code>Runs the second task only on the inactive load balancer:
</code></pre>

<p>% ansible-playbook --ask-vault-password playbooks/nginxplus-test.yml
Vault password: </p>

<p>PLAY [test safer nginxplus approach] ****************************************************************************</p>

<p>TASK [Gathering Facts] ****************************************************************************
ok: [lib-adc2.princeton.edu]
ok: [lib-adc1.princeton.edu]</p>

<p>TASK [check on IP addresses] ****************************************************************************
ok: [lib-adc1.princeton.edu] =&gt; {
    &quot;ansible<em>all</em>ipv4<em>addresses&quot;: [
        &quot;128.112.203.145&quot;,
        &quot;128.112.203.146&quot;
    ]
}
ok: [lib-adc2.princeton.edu] =&gt; {
    &quot;ansible</em>all<em>ipv4</em>addresses&quot;: [
        &quot;128.112.203.144&quot;
    ]
}</p>

<p>TASK [ping only the inactive VM] ****************************************************************************
skipping: [lib-adc1.princeton.edu]
ok: [lib-adc2.princeton.edu]</p>

<p>PLAY RECAP ****************************************************************************
lib-adc1.princeton.edu     : ok=2    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0<br>
lib-adc2.princeton.edu     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0<br>
```
We could use this logic to ensure the playbook only runs on the inactive VM, and even extend the approach to the full round-trip:
1. Gather facts on all hosts
2. Run the role on the inactive host and reload the new config there
3. Restart the active host to switch which LB is active
4. Gather facts again and confirm the active host has switched (though we need a way to &quot;remember&quot; which was which)
5. Run the role on the remaining host and reload the new config there</p>

              </dd>
            </dl>
          </dd>

        </dl>
      </div>

      </div>
    </section>
    <section class="repo" id="pul-it-handbook">
      <h2><a href="https://github.com/pulibrary/pul-it-handbook">pulibrary/pul-it-handbook</a> <i class="fas fa-external-link-alt fa-xs"></i></h2>
      <div class="issues">
        
      <div class="issue even" id="pul-it-handbook-141">
        <h3><a href="https://github.com/pulibrary/pul-it-handbook/pull/141">#141</a> adds details to nginx documentation</h3>
        <dl>
          <dt>Creator:</dt>
          <dd>Alicia Cozine</dd>
          <dt>Created:</dt>
          <dd>2022-12-22 22:16:29</dd>
          <dt>Status:</dt>
          <dd>Closed
          (<a href="https://github.com/pulibrary/pul-it-handbook/pull/141">pull request</a>)
          </dd>
          <dt>Events:</dt>
          <dd>
            <ul class="events">
            
  <li class="event even">
    <code>referenced</code> by Alicia Cozine at 2022-12-28 21:00:00.</li>
  <li class="event odd">
    <code>merged</code> by Alicia Cozine at 2022-12-28 21:00:00.</li>
  <li class="event even">
    <code>closed</code> by Alicia Cozine at 2022-12-28 21:00:00.</li>
  <li class="event odd">
    <code>head_ref_deleted</code> by Alicia Cozine at 2022-12-28 21:00:01.</li>

            </ul>
          </dd>
        </dl>
      </div>

      </div>
    </section>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="../../../../js/report.js"></script>
  </div>
</body>

</html>
